---
title: Regular Expressions & Feature engineering
author: Aleksei Gorgadze
output: html_document
editor_options: 
  chunk_output_type: console
  code_folding: show
---

```{r, eval=FALSE}
#####################################
### Устанавливаем пакеты, если необходимо
#####################################
#install.packages("stringr")
library(stringr)
```


### Регулярные выражения
. - Любой символ
* - Повторение предыдущего символа 0 или большее число раз
+ - Повторение предыдущего символа 1 или большее число раз
? - Повторение предыдущего символа не более 1 раза (0 или 1)
{n} - Повторение предыдущего символа n раз
{n,} - Повторение предыдущего символа не менее n раз
{n,m} - Повторение предыдущего символа от n до m раз

# Маленькое упражнение в регулярных выражениях 

```{r}
(strings <- c("a", "ab", "acb", "accb", "acccb", "accccb"))

?grep

grep("ac*b", strings, value = TRUE)
grep("ac+b", strings, value = TRUE)
grep("ac?b", strings, value = TRUE)
grep("ac{2}b", strings, value = TRUE)
grep("ac{2,}b", strings, value = TRUE)
grep("ac{2,3}b", strings, value = TRUE)

grep("a.b", strings, value = TRUE)
grep("a.*b", strings, value = TRUE)
```

#Позиция паттерна внутри строки
^ - соответствует началу строки
$ - соответствует концу строки
[а-я] - Диапазон: любые символы в указанном диапазоне

# Границы слов
\b - соответсвует началу слова
\d - цифровой символ (эквивалент [0-9])
\D - нецифровой символ
\s - пробельный символ (эквивалент [ \f\n\r\t\v])

R требует двойных обратных следов (потому что "\" уже подразумевает экранирование в R), поэтому, например, для захвата пробелов нужно ввести \\s в R.

```{r}
(strings <- c("abcd", "cdab", "cabd", "c abd"))

grep("ab", strings, value = TRUE)
grep("^ab", strings, value = TRUE)
grep("ab$", strings, value = TRUE)
grep("\\bab", strings, value = TRUE)
grep("ab[c-e]", strings, value = TRUE)
```

### Несколько ссылочек на статьи про регулярные выражения:
https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html
https://stringr.tidyverse.org/articles/regular-expressions.html
https://www.r-studio.com/ru/Unformat_Help/index2.html?regularexpressions.html

## Удобное приложение для подборки регулярного выражения
http://regexr.com

Возьмем следующий текст:
7. И. Т. ЛИСЕНКОВУ 26 января 1842. Петербург Почтеннейший Иван Тимофеевич! Всё будет сделано по Вашему желанию... «Человека с высшим взглядом» возвращаю.1 Пришлите, пожалуйста, книгу «Повесть Ангелина» Н. Молчанова; очень обяжете уважающего Вас Н. Некрасова. 26 января 1842 года Да нельзя ли ненадолго новое издание «Истории крестовых походов» Мишо. Нет ли также «Сто двадцать сказок». Издание Ф. Кузмичева? 8. И. Т. ЛИСЕНКОВУ Между 12 января и 15 февраля 1842. Петербург Любезнейший Иван Тимофеевич! Передайте эту пиесу1 г-же Ишимовой за два экземпляра «Звездочки», если согласится. Пожалуйста, пришлите новых книг, нет ли каких; «Луч солнца»2 роман непременно подайте. «Дорожник» и «Толстоту»3 посылаю. Н. Некрасов. 9. Ф. А. КОНИ 2 апреля 1842. Петербург Почтеннейший Федор Алексеевич! Вот к Вам еще вельми важная просьба. Мы начали с П. И. Григорьевым для его бенефиса комедию-водевиль в 4-х актах под названием «Столбиков»1 в полной уверенности, что Вы не откажетесь также написать акт или хоть сценки две-три. Такое соединение имен, еще небывалое на русской афишке, может принесть существенную пользу бенефицианту. Вот мы писали и поджидали Вас, но между тем Вас нет, и, может быть, Вы еще не скоро будете, а время уходит, бенефис 4-го мая.2 У нас просто руки опустились, и, чтоб не терять

Используем cледующее регулярное выражение:
 [А-Я]{0,1}[а-я]{0,10} *[0-9]{1,2} .{0,30} [0-9]{4}\. [А-я]+


# Более практический пример
```{r}
nicks <- c("I love @let @me @mention @all @the @cool @guys")
str_replace_all(nicks, '@[a-zA-Z0-9_]+', '@user')
```

**Задание 1** При помощи регулярных выражений найдите (str_extract_all) 
и посчитайте (str_count) хештеги в векторе "sem_example". Регулярное выражение должно
выделить все хештеги в посте. Хештег содержит знак "#" и текст после него (до пробела
или пунктуации).
```{r}
sem_example <- c("#ВКонтакте можно общаться не только с друзьями, но и со звёздами. Вы наверняка уже знакомы со своим кумиром — через общих друзей. #ЮрийДудь, #ДанилаПоперечный, #ХабибНурмагомедов, #Монеточка, #ФилиппКиркоров и другие знаменитости ближе, чем кажется. Убедитесь в приложении «Теория рукопожатий»: http://vk.com/app6711649_-22822305 И это не всё. Помните, как в прошлом году #VK2018Pixel Battle объединил больше полумиллиона человек и почти 12 тысяч сообществ в масштабной схватке за пиксели? Сегодня Вас ждёт новое полотно: http://vk.com/app5990572_-22822305")


```

**Задание 2** При помощи регулярных выражений найдите (str_extract_all) 
и замените (str_replace_all) ссылкы на "url_link" в предыдущем примере (sem_example):

```{r}


```

**Задание 3** При помощи регулярных выражений найдите (str_extract_all) 
и удалите (str_replace_all) двойные пробелы:

```{r}
sem_example3 <- '    some text on line one; 
and then some text on line two     '

```

**Задание 4** При помощи регулярных выражений найдите (str_extract_all) 
и замените (str_replace_all) электронные почтовые ящики разных доменов (gmail, yandex,
hse) на "email".

```{r}
sem_example4 <- "Мои основные почтовые ящики - ivan.petrov@gmail.com и i_petrov@yandex.ru, но по рабочим вопросам лучше писать на ipetrov@hse.ru"

```